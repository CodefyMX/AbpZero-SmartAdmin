(function(){"use strict";function n(n,t,i,r){function c(){u.treeData=[];n.getOrganizationUnitsConfigModel().then(function(n){for(var i=n.data,t=0;t<i.organizationUnits.length;t++)a(i.organizationUnits[t]);f()})}function f(){u.treeConfig.version++}function a(n){var i=new l(n.id,n.parentId,n.displayName),t;if(u.treeData.push(i),n.childrenDto.length>0)for(t=0;t<n.childrenDto.length;t++)a(n.childrenDto[t])}var u=this,e,o,s,h,l;u.treeData=[];u.tree={};e=function(t){return{addUnit:{label:App.localize("AddOrganizationUnit"),action:function(){u.openCreateModal(null,t.id)}},editUnit:{label:App.localize("EditOrganizationUnit"),action:function(){u.openCreateModal(t.id,null)}},deleteUnit:{label:App.localize("DeleteOrganizationUnit"),action:function(){abp.message.confirm(App.localize("TheUnitWillBeDeleted"),App.localize("ConfirmQuestion"),function(i){i&&(abp.ui.setBusy(),n.removeOrganizationUnit(t.id).then(function(){abp.ui.clearBusy();u.removeFromTree(t);f()}))})}}}};o=function(n){i.go("OrganizationUnits.Orgunitusers",{id:n})};u.removeFromTree=function(n){for(var t=0;t<u.treeData.length;t++)u.treeData[t].id==n.id&&u.treeData.splice(t,1)};s=function(t,i){var r=i.data.origin.get_node(i.data.nodes[0]);if(r.type==="root")return!1;var u=i.data.nodes[0],e=r.parent,o={Id:u,ParentId:e};return t.preventDefault(),n.moveOrgUnit(o).then(function(){return!0}).catch(function(){f()}),!0};h=function(n,t){var i=t.node.id;o(i)};u.treeEventHandlers={"dnd_stop.vakata":s,"select_node.jstree":h};u.treeConfig={contextmenu:{items:e},core:{themes:{name:"proton",responsive:!0},check_callback:!0},plugins:["wholerow","html_data","ui","contextmenu","dnd"],version:1};c();u.openCreateModal=function(n,i){var u=t.open({templateUrl:r.contentFolder+"organizationUnits/create.cshtml",controller:"app.views.organizationUnits.create as vm",resolve:{items:function(){var t={};return n&&(t.id=n),i&&(t.parentId=i),t}}});u.result.then(function(n){n==="created"&&c()})};l=function(n,t,i){return t||(t="#"),this.id=+n,this.parent=t,this.text=i,this.state={opened:!0},this}}angular.module("app.web").controller("app.views.organizationUnits.index",n);n.$inject=["abp.services.app.organizationUnits","$uibModal","$state","WebConst"]})();