
@{
    Layout = null;
}
@model Cinotam.Cms.App.Categories.Dto.CategoryForEditModel
<div class="modal-dialog" role="document">
    <div class="modal-content">
        <form id="createCategoryForm">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModal-label">@L("CreateEditMenu")</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="form-group">
                            @Html.HiddenFor(a => a.Id)
                            <label class="control-label" for="Name">@L("Name")</label>
                            @Html.TextBoxFor(a => a.Name, new { @class = "form-control", required = "required" })
                            <br />
                            <br />
                            @foreach (var lang in Model.CategoryLangContents)
                            {

                                <br />
                                <label class="control-label"><i class="@lang.Icon"></i> @lang.Lang</label>
                                <input data-content-id="@lang.Id" data-id="@Model.Id" data-lang="@lang.Lang" value="@lang.DisplayText" type="text" class="form-control js-lang-input" />
                            }
                        </div>
                    </div>
                </div>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">@L("Close")</button>
                <button type="submit" class="btn btn-primary">@L("Save")</button>
            </div>
        </form>

    </div>
</div>
<script>
    (function () {

        $("#createCategoryForm").on("submit", function (e) {
            e.preventDefault();
            var availableLangs = [];
            $(".js-lang-input")
                .each(function (i, element) {
                    var $element = $(element);
                    var langInput = {
                        Lang: $element.data("lang"),
                        MenuId: $element.data("id"),
                        Text: $element.val()
                    }
                    availableLangs.push(langInput);
                });
            var data = {
                Name: $("#Name").val(),
                DisplayName: $("#DisplayName").val(),
                LanguageInputs: availableLangs
            }
            abp.ui.setBusy($("#createCategoryForm"), abp.services.cms.categoryService.addEditCategory(data).done(function () {
                window.location.reload();
            }));

        });


    }) ();
</script>